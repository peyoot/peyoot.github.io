import{_ as e,o as a,c as t,b as s}from"./app-Dbzm7Suq.js";const n={},r=s(`<h1 id="域名证书管理和更新" tabindex="-1"><a class="header-anchor" href="#域名证书管理和更新"><span>域名证书管理和更新</span></a></h1><p>server-maintainer项目中使用到的域名证书和申请和更新，可以用acme.sh工具配合renew_and_upload_certs.sh实现。</p><p>acme.sh是第三方工具，通过它可以申请泛域名证书。不过部署和更新时，还是用renew_and_upload_certs.sh脚本更方便。这个脚本会根据配置文件domain.list中的域名和服务器连接信息，依次为相关的域名通过acme.sh申请更新并上传到相应服务器~/certs目录下，在远程服务器上，只需将证书链接文件指向这个目录即可。</p><h2 id="acme-sh安装和使用" tabindex="-1"><a class="header-anchor" href="#acme-sh安装和使用"><span>acme.sh安装和使用</span></a></h2><p>如果没安装 过，可以用curl https://get.acme.sh | sh</p><p>检查配置，以及哪些证书在这台服务器上申请 acme.sh --info acme.sh --list</p><p>如果没有添加相关的域名服务商的密钥，添加一下： export GD_Key=&quot;38...rN&quot; export GD_Secret=&quot;J3...XL&quot;</p><p>添加新的申请 acme.sh --issue --dns dns_gd -d domain.com -d *.domain.com</p><p>或是更完整一点 acme.sh --set-default-ca --server letsencrypt --issue --dns dns_gd --dnssleep 300 -d eccee.com -d *.eccee.com</p><p>申请成功后，每个域名都会在~/.acme.sh/下有个目录，里面有相应的证书</p><p>如果要使用vpn，为了避免登陆问题，建议MTU的配置如下：</p><p>tun-mtu 1400</p><h2 id="renew-and-upload-certs-sh-使用" tabindex="-1"><a class="header-anchor" href="#renew-and-upload-certs-sh-使用"><span>renew_and_upload_certs.sh 使用</span></a></h2><p>这个脚本中用到SCP需要能免密登陆到远程服务器， 注意为了防止openssl版本不一致引发的问题，建议都用ubuntu 22.04以上的版本</p><p>ssh-copy-id -p 10022 -i ~/.ssh/id_ed25519.pub ubuntu@192.168.13.254</p><p>在远程服务器把ubuntu加到sudoers中， 查看用sudo grep -n &#39;NOPASSWD&#39; /etc/sudoers 编辑用sudo visudo 内容：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>username ALL=(ALL) NOPASSWD: ALL
%groupname ALL=(ALL) NOPASSWD: ALL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 username 是不需要密码即可使用 sudo 的用户名，%groupname 是不需要密码即可使用 sudo 的用户组名。</p><p>编辑域名配置文件domain.list</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>mydomain.com ubuntu@192.168.13.254:1022 /home/ubuntu/certs
domain2.com ubuntu@100.10.10.100:22 /home/ubuntu/certs

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行脚本：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code> renew_and_upload_certs.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,22),d=[r];function i(c,o){return a(),t("div",null,d)}const p=e(n,[["render",i],["__file","domaincerts.html.vue"]]),u=JSON.parse('{"path":"/zh/server-maintainer/domaincerts.html","title":"域名证书管理和更新","lang":"zh-CN","frontmatter":{"description":"域名证书管理和更新 server-maintainer项目中使用到的域名证书和申请和更新，可以用acme.sh工具配合renew_and_upload_certs.sh实现。 acme.sh是第三方工具，通过它可以申请泛域名证书。不过部署和更新时，还是用renew_and_upload_certs.sh脚本更方便。这个脚本会根据配置文件domain.l...","head":[["meta",{"property":"og:url","content":"https://peyoot.github.io/zh/server-maintainer/domaincerts.html"}],["meta",{"property":"og:title","content":"域名证书管理和更新"}],["meta",{"property":"og:description","content":"域名证书管理和更新 server-maintainer项目中使用到的域名证书和申请和更新，可以用acme.sh工具配合renew_and_upload_certs.sh实现。 acme.sh是第三方工具，通过它可以申请泛域名证书。不过部署和更新时，还是用renew_and_upload_certs.sh脚本更方便。这个脚本会根据配置文件domain.l..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"域名证书管理和更新\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"acme.sh安装和使用","slug":"acme-sh安装和使用","link":"#acme-sh安装和使用","children":[]},{"level":2,"title":"renew_and_upload_certs.sh 使用","slug":"renew-and-upload-certs-sh-使用","link":"#renew-and-upload-certs-sh-使用","children":[]}],"git":{},"autoDesc":true,"filePathRelative":"zh/server-maintainer/domaincerts.md"}');export{p as comp,u as data};
