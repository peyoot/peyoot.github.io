import{_ as e,o as t,c as d,b as a}from"./app-oTA4_50g.js";const i={},n=a(`<h2 id="简单修改驱动添加调试输出" tabindex="-1"><a class="header-anchor" href="#简单修改驱动添加调试输出"><span>简单修改驱动添加调试输出</span></a></h2><p>如果你只是想看 dmesg 中的基本日志，不用 dynamic debug。可以临时提高内核 loglevel（echo 8 &gt; /proc/sys/kernel/printk）来显示更多 pr_debug（但不针对特定文件/函数）。或在 ads7846.c 中改用 printk(KERN_DEBUG &quot;...&quot;) 而非 dev_dbg，重建模块（无需 dynamic debug）。</p><h2 id="内核开启动态调试" tabindex="-1"><a class="header-anchor" href="#内核开启动态调试"><span>内核开启动态调试</span></a></h2><p>默认已经有：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>CONFIG_DEBUG_FS=y
CONFIG_DEBUG_FS_ALLOW_ALL=y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>加上</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>CONFIG_DYNAMIC_DEBUG_CORE=y
CONFIG_DYNAMIC_DEBUG=y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>验证：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>zcat /proc/config.gz | grep CONFIG_DYNAMIC_DEBUG 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>应输出 CONFIG_DYNAMIC_DEBUG=y 和 CONFIG_DYNAMIC_DEBUG_CORE=y</p><h2 id="挂载debugfs-默认自动挂载" tabindex="-1"><a class="header-anchor" href="#挂载debugfs-默认自动挂载"><span>挂载debugfs (默认自动挂载)</span></a></h2><p>如果内核在 boot 时通过 cmdline 参数（如 dyndbg=&quot;file ads7846.c +p&quot;）启用了 dynamic debug，你甚至不用手动挂载/配置，就能直接在 dmesg 看到日志。 但在运行时动态调整（如针对特定驱动），还是需要挂载 debugfs 来操作 control 文件。嵌入式一般boot时未自动挂载，所以需运行一次 mount 命令（可加到 /etc/fstab 或 init 脚本中永久化）。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>mount -t debugfs none /sys/kernel/debug
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>测试后，运行 ls /sys/kernel/debug/ 确认有 dynamic_debug 目录即可。</p><p>事实上，dey已经默认是自动挂载，有这个dynamic_debug目录。</p><h2 id="启用-ads7846-调试" tabindex="-1"><a class="header-anchor" href="#启用-ads7846-调试"><span>启用 ads7846 调试</span></a></h2><p>运行下面命令</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>echo &#39;file drivers/input/touchscreen/ads7846.c +p&#39; &gt; /sys/kernel/debug/dynamic_debug/control
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>调大loglevel</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>echo 8 &gt; /proc/sys/kernel/printk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>触碰屏幕，查看 dmesg 中的日志</p>`,21),s=[n];function l(r,c){return t(),d("div",null,s)}const p=e(i,[["render",l],["__file","dynamic-debug.html.vue"]]),u=JSON.parse('{"path":"/zh/deyaio/wiki/dynamic-debug.html","title":"","lang":"zh-CN","frontmatter":{"description":"简单修改驱动添加调试输出 如果你只是想看 dmesg 中的基本日志，不用 dynamic debug。可以临时提高内核 loglevel（echo 8 > /proc/sys/kernel/printk）来显示更多 pr_debug（但不针对特定文件/函数）。或在 ads7846.c 中改用 printk(KERN_DEBUG \\"...\\") 而非 de...","head":[["meta",{"property":"og:url","content":"https://peyoot.github.io/zh/deyaio/wiki/dynamic-debug.html"}],["meta",{"property":"og:description","content":"简单修改驱动添加调试输出 如果你只是想看 dmesg 中的基本日志，不用 dynamic debug。可以临时提高内核 loglevel（echo 8 > /proc/sys/kernel/printk）来显示更多 pr_debug（但不针对特定文件/函数）。或在 ads7846.c 中改用 printk(KERN_DEBUG \\"...\\") 而非 de..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"简单修改驱动添加调试输出","slug":"简单修改驱动添加调试输出","link":"#简单修改驱动添加调试输出","children":[]},{"level":2,"title":"内核开启动态调试","slug":"内核开启动态调试","link":"#内核开启动态调试","children":[]},{"level":2,"title":"挂载debugfs (默认自动挂载)","slug":"挂载debugfs-默认自动挂载","link":"#挂载debugfs-默认自动挂载","children":[]},{"level":2,"title":"启用 ads7846 调试","slug":"启用-ads7846-调试","link":"#启用-ads7846-调试","children":[]}],"git":{},"autoDesc":true,"filePathRelative":"zh/deyaio/wiki/dynamic-debug.md"}');export{p as comp,u as data};
