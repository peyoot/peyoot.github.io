import{_ as d,r as n,o as s,c as r,a as i,d as e,e as t,b as o}from"./app-oTA4_50g.js";const c={},l=o(`<h1 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h1><hr><p>为了正确安装和使用dey-aio，您需要安装yocto开发环境所需的依赖包，如果您要使用docker进行开发，则还需要安装docker和docker-compose。 强烈建议您使用一台Linux服务器来安装deyaio开发环境。由于编译自定义的Linux镜像，特别是第一次编译耗时较长，尽量避免使用笔记本或日常工作的电脑来安装DEY开发环境。使用服务器来安装开发环境，在开发时通过日常工作所用的电脑 SSH远程登陆的方式来进行配置和编译，结合tmux工具让编译在SSH Session退出或关闭的情况下不中断编译过程，从而获得更好的系统编译开发体验。 下面安装过程以Ubuntu 22.04为例，同样也适用于Ubuntu 20.04，请使用普通用户来执行这些命令。</p><p>由于国内github访问经常被间歇式阻断，而编译过程中需要流畅的github访问，建议使用PVPN自行搭建科学上网的环境，以确保编译不受GFW防火墙的干扰。</p><h2 id="安装必要的依赖包" tabindex="-1"><a class="header-anchor" href="#安装必要的依赖包"><span>安装必要的依赖包</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo apt update
sudo apt install gawk wget bison file flex git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa-dev libsdl1.2-dev libncurses-dev pylint xterm python3-subunit mesa-common-dev zstd liblz4-tool tmux
sudo apt install python-is-python3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装repo并配置好git" tabindex="-1"><a class="header-anchor" href="#安装repo并配置好git"><span>安装repo并配置好git</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo apt install repo
git config --global user.name  “yourname”   请用你的英文名称替换yourname
git config --global user.email &quot;you@email.com“  请用你的邮箱替换
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装docker和docker-compose" tabindex="-1"><a class="header-anchor" href="#安装docker和docker-compose"><span>安装docker和docker-compose</span></a></h2><p>如果您打算用一套deyaio工具集来开发不同版本的DEY固件，可以用docker的方式在同一个主机上支持不同的DEY版本。新用户可以略过docker安装这一部分，直接进入下一个环节来安装dey-aio工具集。</p><div class="language-text-plain line-numbers-mode" data-ext="text-plain" data-title="text-plain"><pre class="language-text-plain"><code>sudo apt install docker.io docker-compose  
sudo gpasswd -a $USER docker     #将登陆用户加入到docker用户组中
newgrp docker     #更新用户组
reboot 请先重启一下电脑
docker ps    #测试docker命令是否可以使用sudo正常使用
docker network create pvpn --subnet 172.100.100.0/24    #创建配合科学上网使用自定义网络
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="用repo安装dey-aio工具集" tabindex="-1"><a class="header-anchor" href="#用repo安装dey-aio工具集"><span>用repo安装dey-aio工具集</span></a></h2><p>dey-aio-manifest的main分支持包含不同版本的DEY支持，如果只需开发特定版本，也可以用Yocto代号指定</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd
mkdir dey-aio
cd dey-aio
repo init -u https://github.com/peyoot/dey-aio-manifest.git -b main 
repo sync
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，dey-aio的工具集就安装好了，可以新建项目进行DEY系统开发。如果项目有需要，您也可以使用repo命令来在不同的manifest仓库间切换，以使用不同的特性支持。</p><p>您也可以在安装DEY时就指定好功能特性支持。比如开发基于ccmp25的PLC系列DEY 5.0镜像，参考如下：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd
mkdir deyaio-ccmp25plc   
cd deyaio-ccmp25plc
repo init -u https://github.com/peyoot/dey-aio-manifest.git -b scarthgap -m ccmp25plc.xml   
repo sync
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p></p><h1 id="dey系统开发" tabindex="-1"><a class="header-anchor" href="#dey系统开发"><span>DEY系统开发</span></a></h1><hr>`,20),p={href:"https://www.github.com/peyoot/pvpn.git",target:"_blank",rel:"noopener noreferrer"},m={href:"https://www.eccee.com/soft-platform/224.html",target:"_blank",rel:"noopener noreferrer"},u=o(`<p>dey-aio的目录结构如下，：<br> /<br> ├── aio                     不同dey版本所需的dey-aio工具和自定义layer<br> │   ├── scarthgap     <br> │   ├── kirkstone | ...<br> ├── dey5.0                     DEY 4.0工具集<br> │   ├──docker-compose.yml    <br> │   ├── mkproject.sh       项目创建工具  <br> │   ├── publish.sh             发布工具 │   ├── sources             源码目录<br> │   ├── workspace            项目目录 <br> ├── dey4.0<br> │   ├──docker-compose.yml    <br> │   ├── mkproject.sh       项目创建工具  <br> │   ├── publish.sh             发布工具 │   ├── sources             源码目录<br> │   ├── workspace            项目目录 <br> | ...<br> ├── release                    发布文件夹 (可选发布到这里或服务器上)<br> │   ├── dey5.0                   <br> │        ├── cc6ul<br> │        ├── ccmp15<br> │        ├── cc8mn<br> │        ├── cc8mm<br> │        ├── cc8x<br> │        ├── ...<br> │   ├── dey4.0                   <br> │        ├── ...<br> │   └ …<br> ├── README.md<br> └── README-cn.md</p><p>要进行项目开发，您需要进入项目所需的DEY版本，然后创建项目。您可以使用docker-compose的方式来创建项目，也可以直接使用官方原生的方法来创建项目。两种方式可共用workspace作为项目目录。</p><p>第一次使用，一般建议直接用官方原生的办法来创建项目并编译系统镜像。</p><h2 id="使用docker-compose的开发方式" tabindex="-1"><a class="header-anchor" href="#使用docker-compose的开发方式"><span>使用docker-compose的开发方式</span></a></h2><p>docker-compose可以快速创建一个与主机隔离的dey的开发环境容器，要创建一个新的docker容器来进行开发，可以用：docker-compose run dey&lt;版本号&gt;，这里的版本号可以是3.2或4.0，容器默认使用peyoot/dey作为DEY的镜像，您也可以修改docker-compose.yml，使用官方的digidotcom/dey镜像。<br> 例：<code>docker-compose run dey4.0</code><br> 这样就可以自动开启容器，并提示您创建项目还是使用原有项目继续开发，如下图所示：</p><pre> +------------------------------------------------------------------------------------+
 |                                                                                    |
 |                                                                                    |
 |                   Welcome to Digi Embedded Yocto Docker container                  |
 |                                                                                    |
 |  This Docker image is a ready to use system based on Digi Embedded Yocto (DEY) to  |
 |  build custom images for the Digi platforms. DEY is an open source and freely      |
 |  available Yocto Project (TM) based embedded Linux distribution.                   |
 |                                                                                    |
 |                                                                                    |
 +------------------------------------------------------------------------------------+
 Do you wish to create a new platform project [Y/N]?
</pre><p>输入Y会让您从所支持的开发板中选择当前项目所使用的som或单板机，然后就可以开始编译生成镜像了。<br><code>bitbake dey-image-qt</code></p><p>如果输入N，则不创建新项目，用户可以到原有的项目中继续从事开发。</p>`,8),b={href:"https://github.com/peyoot/dey-aio.git",target:"_blank",rel:"noopener noreferrer"},h=o(`<h2 id="使用官方原生的digi-embedded-yocto开发方式" tabindex="-1"><a class="header-anchor" href="#使用官方原生的digi-embedded-yocto开发方式"><span>使用官方原生的Digi Embedded Yocto开发方式</span></a></h2><p>dey-aio工具集在安装时就已经自动拉取DEY源码到sources，您可以在workspace中创建项目，直接编译。开发方式和官方并没有区别，只是我们把DEY安装在当前目录下，我们需要进入workspace创建新项目的名称，然后和官方一样，用mkproject.sh来创建项目。本项目对下载目录和sstate缓存做了一些优化处理，它们都存放于父级目录下的project_shared，以方便不同项目使用。以创建cc93项目和ccmp25项目为例：</p><div class="language-text-plain line-numbers-mode" data-ext="text-plain" data-title="text-plain"><pre class="language-text-plain"><code>#ConnectCore 93可参考如下：
cd workspace
mkdir cc93
cd cc93
source ../../mkproject.sh -l
source ../../mkproject.sh -p ccimx93-dvk

bitbake dey-image-qt

#ConnectCore MP2系列核心模块或其它模块类似，请选择对应的平台来source项目，并编译目标镜像：
cd workspace
mkdir ccmp25
source ../../mkproject.sh -l
source ../../mkproject.sh -p ccmp25-dvk
bitbake tf-a-stm32mp
bitbake fip-stm32mp
bitbake core-image-base
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="关于meta-custom" tabindex="-1"><a class="header-anchor" href="#关于meta-custom"><span>关于meta-custom</span></a></h1><hr><p>meta-custom作为一个Yocto的示例layer，用于用户将自定义的程序或配置文件，自启动服务或脚本，驱动程序等文件编译到系统镜像中。用户可以根据项目需要自行更改源码和维护自己的版本库。 为了更方便编排ros，把meta-custom单独作为一个git库，从dey4.0 kirkstone最新版开始，meta-custom不在是dey-aio的一部分</p><h1 id="发布工具" tabindex="-1"><a class="header-anchor" href="#发布工具"><span>发布工具</span></a></h1><p>编译结束后，您可以到对应的DEY版本目录下，使用publish.sh来将编译结果发布到release目录下，并打包成卡刷包，也可以选择发布到TFTP或NFS路径上，方便快速开发测试。</p><div class="language-text-plain line-numbers-mode" data-ext="text-plain" data-title="text-plain"><pre class="language-text-plain"><code>./publish.sh
按提示选择并发布相关的镜像
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,9);function v(g,k){const a=n("ExternalLinkIcon");return s(),r("div",null,[l,i("p",null,[e("关于科学上网：考虑到国内对github的访问并不顺畅，由于墙对境外IP的阻断方式是间歇式的断开TCP连接，在使用本工具集首次编译时需要科学上网。如果您从未实践过科学上网，可以在位于境外IP的任意云服务器上使用"),i("a",p,[e("peyoot/pvpn"),t(a)]),e("的开源工具快速架设科学上网环境所需的vpn服务器（"),i("a",m,[e("文档"),t(a)]),e("），然后在本地开发机器上使用相同的工具自动部署vpn客户端，从而实现编译时所需的科学上网环境。（注：上述的安装过程，不论是否需要科学上网，均可正常使用）")]),u,i("p",null,[e("您可以使用exit退出 docker环境，并用docker-compose down来关闭容器。更多用法请参考"),i("a",b,[e("dey-aio项目"),t(a)]),e("。")]),h])}const x=d(c,[["render",v],["__file","get-started.html.vue"]]),f=JSON.parse('{"path":"/zh/deyaio/get-started.html","title":"安装","lang":"zh-CN","frontmatter":{"description":"安装 为了正确安装和使用dey-aio，您需要安装yocto开发环境所需的依赖包，如果您要使用docker进行开发，则还需要安装docker和docker-compose。 强烈建议您使用一台Linux服务器来安装deyaio开发环境。由于编译自定义的Linux镜像，特别是第一次编译耗时较长，尽量避免使用笔记本或日常工作的电脑来安装DEY开发环境。使用...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://peyoot.github.io/deyaio/get-started.html"}],["meta",{"property":"og:url","content":"https://peyoot.github.io/zh/deyaio/get-started.html"}],["meta",{"property":"og:title","content":"安装"}],["meta",{"property":"og:description","content":"安装 为了正确安装和使用dey-aio，您需要安装yocto开发环境所需的依赖包，如果您要使用docker进行开发，则还需要安装docker和docker-compose。 强烈建议您使用一台Linux服务器来安装deyaio开发环境。由于编译自定义的Linux镜像，特别是第一次编译耗时较长，尽量避免使用笔记本或日常工作的电脑来安装DEY开发环境。使用..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"安装\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"安装必要的依赖包","slug":"安装必要的依赖包","link":"#安装必要的依赖包","children":[]},{"level":2,"title":"安装repo并配置好git","slug":"安装repo并配置好git","link":"#安装repo并配置好git","children":[]},{"level":2,"title":"安装docker和docker-compose","slug":"安装docker和docker-compose","link":"#安装docker和docker-compose","children":[]},{"level":2,"title":"用repo安装dey-aio工具集","slug":"用repo安装dey-aio工具集","link":"#用repo安装dey-aio工具集","children":[]},{"level":2,"title":"使用docker-compose的开发方式","slug":"使用docker-compose的开发方式","link":"#使用docker-compose的开发方式","children":[]},{"level":2,"title":"使用官方原生的Digi Embedded Yocto开发方式","slug":"使用官方原生的digi-embedded-yocto开发方式","link":"#使用官方原生的digi-embedded-yocto开发方式","children":[]}],"git":{},"autoDesc":true,"filePathRelative":"zh/deyaio/get-started.md"}');export{x as comp,f as data};
